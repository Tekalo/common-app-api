# Email Sender

The code in this package is responsible for sending emails for the api. It consists of an SQS queue and a lambda function. The api writes messages to the SQS queue that contain the information necessary for sending an email:

```bash
{ recipientEmail,
  subject,
  htmlBody,
  textBody,
}
```

The lambda function takes messages from the SQS queue, converts them into `SendEmailCommandInput` objects that are understood by SES, and sends the emails (via SES).

This functionality was separated out of the api to speed up requests that result in emails being sent (applicant registration, deletion requests, etc).

## Configuration and deployment

The configuration of the email sender is in the terraform `email` module ([here](/tf/modules/email)). The lambda and SQS queue will be deployed by our CI pipeline if the module is configured in the individual environments (for example, [the dev configuration](/tf/envs/dev/main.tf#37-41)).

If changes are made to the lambda source code, an email-sender.zip file can be generated by running

```bash
pnpm package:email-sender
```

from the root of the repository. This will compile the code, copy node_modules and the email-sender package json into the build directory, create a zip file, and copy the zip file into the `/tf/envs/dev` directory to be deployed.

To publish changes to the lambda code to staging or production,`email-sender.zip` needs to be manually copied to the relevant `/tf/envs/<env>` directory.
